# üì¶ Migration Guide: express-migration ‚Üí mongoose-migration

## –û–≥–ª—è–¥

–¶—è –≥—ñ–ª–∫–∞ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å –ø—Ä–æ—î–∫—Ç —ñ–∑ in-memory –º–æ–∫—ñ–≤ –¥–æ MongoDB Atlas –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º Mongoose. –ù–∏–∂—á–µ –æ–ø–∏—Å–∞–Ω–æ –∫–ª—é—á–æ–≤—ñ –∑–º—ñ–Ω–∏, –º—ñ–≥—Ä–∞—Ü—ñ–π–Ω—ñ —Å–∫—Ä–∏–ø—Ç–∏ —Ç–∞ –∫—Ä–æ–∫–∏ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è –ø—Ä–æ—Ü–µ—Å—É –Ω–∞ –Ω–æ–≤–æ–º—É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ.

## 1. –ó–º—ñ–Ω–∏ —É —Å—Ç—Ä—É–∫—Ç—É—Ä—ñ –¥–∞–Ω–∏—Ö

- –í–∏–¥–∞–ª–µ–Ω–æ `src/data/products.mjs` —ñ–∑ –º–∞—Å–∏–≤–æ–º –º–æ–∫—ñ–≤.
- –î–æ–¥–∞–Ω–æ `seeds/products.json` ‚Äî –¥–∂–µ—Ä–µ–ª–æ –ø–æ—á–∞—Ç–∫–æ–≤–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ (9 –ø—Ä–æ–¥—É–∫—Ç—ñ–≤).
- –°—Ç–≤–æ—Ä–µ–Ω–æ `scripts/seedProducts.mjs` –¥–ª—è —ñ–º–ø–æ—Ä—Ç—É JSON —É –∫–æ–ª–µ–∫—Ü—ñ—é `products`.
- –£—Å—ñ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∏ –ø—Ä–∞—Ü—é—é—Ç—å –Ω–∞–ø—Ä—è–º—É –∑ `ProductModel` (Mongoose).

## 2. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è

- `src/config/index.mjs` —Ç–µ–ø–µ—Ä —Ñ–æ—Ä–º—É—î URI MongoDB (Atlas –∞–±–æ –ª–æ–∫–∞–ª—å–Ω–∏–π) —ñ –Ω–∞–¥–∞—î –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ `autoIndex`, `maxPoolSize`.
- `src/database/connection.mjs` –∫–µ—Ä—É—î –∂–∏—Ç—Ç—î–≤–∏–º —Ü–∏–∫–ª–æ–º Mongoose, –ª–æ–≥—É—î –ø–æ–¥—ñ—ó –π –ø–æ–≤–µ—Ä—Ç–∞—î —ñ—Å–Ω—É—é—á–µ –∑‚Äô—î–¥–Ω–∞–Ω–Ω—è.
- `src/server.mjs` –≤–∏–∫–ª–∏–∫–∞—î `ProductModel.syncIndexes()` –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ.
- –í–∞–ª—ñ–¥–∞—Ü—ñ—è ObjectId –¥–æ–¥–∞–Ω–∞ —á–µ—Ä–µ–∑ middleware `validateObjectIdParam` (API —Ç–∞ Web).

## 3. Seed —Ç–∞ —Ç–µ—Å—Ç–∏

- `yarn node scripts/seedProducts.mjs` ‚Äî –æ—á–∏—â—É—î –∫–æ–ª–µ–∫—Ü—ñ—é —ñ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î JSON —É MongoDB.
- `yarn node scripts/checkServer.mjs` ‚Äî —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ–π–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞, —â–æ –æ—Ö–æ–ø–ª—é—î API + HTML –º–∞—Ä—à—Ä—É—Ç–∏.
- `yarn test` ‚Äî —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ–π–Ω—ñ —Ç–µ—Å—Ç–∏ (`node:test` + Supertest) –Ω–∞ –±–∞–∑—ñ `atlas-products-test`; –ø—ñ—Å–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–ª–µ–∫—Ü—ñ—ó —Ç–µ—Å—Ç–æ–≤–æ—ó –ë–î –¥—Ä–æ–ø–∞—é—Ç—å—Å—è.

## 4. –í–∫–∞–∑—ñ–≤–∫–∏ –¥–ª—è –º—ñ–≥—Ä–∞—Ü—ñ—ó

1. **–û–Ω–æ–≤—ñ—Ç—å `.env`**:
   ```ini
   MONGODB_URI=mongodb+srv://<user>:<pass>@cluster.mongodb.net/
   DB_NAME=atlas-products
   MONGOOSE_AUTO_INDEX=false        # prod —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ –≤–∏–º–∫–Ω—É—Ç–∏
   MONGOOSE_MAX_POOL_SIZE=20        # –Ω–∞–ª–∞—à—Ç—É–π—Ç–µ –∑–∞ –ø–æ—Ç—Ä–µ–±–∏
   ```
2. **–ó–∞–ø—É—Å—Ç—ñ—Ç—å seed** (—Ç—ñ–ª—å–∫–∏ –æ–¥–∏–Ω —Ä–∞–∑ –Ω–∞ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ):
   ```bash
   yarn node scripts/seedProducts.mjs
   ```
3. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å–µ—Ä–≤—ñ—Å**:
   ```bash
   yarn node scripts/checkServer.mjs
   ```
4. **–ó–∞–ø—É—Å—Ç—ñ—Ç—å —Ç–µ—Å—Ç–∏**:
   ```bash
   yarn test
   ```

## 5. –©–æ –∑–º—ñ–Ω–∏–ª–æ—Å—è

| –†–∞–Ω—ñ—à–µ (`express-migration`) | –¢–µ–ø–µ—Ä (`mongoose-migration`)                         |
| ---------------------------- | ---------------------------------------------------- |
| –î–∞–Ω—ñ –∑–±–µ—Ä—ñ–≥–∞–ª–∏—Å—å —É –º–∞—Å–∏–≤—ñ    | –î–∞–Ω—ñ –≤ MongoDB Atlas                                 |
| –õ–æ–≥—ñ–∫–∞ CRUD —É –º–æ–¥–µ–ª—ñ         | CRUD —á–µ—Ä–µ–∑ Mongoose `ProductModel`                   |
| Seed —á–µ—Ä–µ–∑ —ñ–º–ø–æ—Ä—Ç –º–æ–¥—É–ª—è     | Seed —á–µ—Ä–µ–∑ JSON + Mongoose —Å–∫—Ä–∏–ø—Ç                    |
| –¢–µ—Å—Ç–∏ –ø—Ä–∞—Ü—é–≤–∞–ª–∏ –∑ in-memory  | –¢–µ—Å—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –æ–∫—Ä–µ–º—É –ë–î `atlas-products-test` |
| –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è –¥–ª—è –º–æ–∫—ñ–≤       | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è –æ–ø–∏—Å—É—î Atlas + Mongoose                 |

## 6. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó

- –î–ª—è production –≤–∏–º–∫–Ω—ñ—Ç—å `autoIndex` —ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `ProductModel.syncIndexes()` –ø—Ä–∏ –¥–µ–ø–ª–æ—ó.
- –ó–±–µ—Ä—ñ–≥–∞–π—Ç–µ seed JSON –∞–∫—Ç—É–∞–ª—å–Ω–∏–º —ñ –≤–µ—Ä—Å—ñ–æ–Ω—É–π—Ç–µ –π–æ–≥–æ.
- –°—Ç–≤–æ—Ä—ñ—Ç—å –æ–∫—Ä–µ–º–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ Atlas –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ—ó –ë–î —ñ–∑ –ø—Ä–∞–≤–∞–º–∏ `dbOwner` (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–µ–Ω `dropDatabase`).
- –í–µ–¥—ñ—Ç—å –∂—É—Ä–Ω–∞–ª –∑–º—ñ–Ω —É `docs/MIGRATION.md` –¥–ª—è –º–∞–π–±—É—Ç–Ω—ñ—Ö –º—ñ–≥—Ä–∞—Ü—ñ–π.

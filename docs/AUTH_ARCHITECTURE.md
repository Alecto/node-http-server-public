# üèóÔ∏è –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó (Hybrid Auth)

> **TL;DR:** Auth0 –¥–ª—è –≤—Ö–æ–¥—É ‚Üí –í–ª–∞—Å–Ω—ñ JWT —Ç–æ–∫–µ–Ω–∏ –¥–ª—è API

---

## –®–≤–∏–¥–∫–∏–π –æ–≥–ª—è–¥

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îÇ 1Ô∏è‚É£ –ù–∞—Ç–∏—Å–∫–∞—î "–£–≤—ñ–π—Ç–∏"
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Auth0     ‚îÇ ‚óÑ‚îÄ‚îÄ OAuth 2.0 (Google, GitHub)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îÇ 2Ô∏è‚É£ –ü–æ–≤–µ—Ä—Ç–∞—î –¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Express Server      ‚îÇ
‚îÇ  - –ó–±–µ—Ä—ñ–≥–∞—î user –≤   ‚îÇ
‚îÇ    MongoDB           ‚îÇ
‚îÇ  - –ì–µ–Ω–µ—Ä—É—î –í–õ–ê–°–ù–ò–ô   ‚îÇ
‚îÇ    JWT —Ç–æ–∫–µ–Ω         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îÇ 3Ô∏è‚É£ –ü–æ–≤–µ—Ä—Ç–∞—î —Ç–æ–∫–µ–Ω –∫–ª—ñ—î–Ω—Ç—É
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  API –ó–∞–ø–∏—Ç–∏ ‚îÇ ‚óÑ‚îÄ‚îÄ Authorization: Bearer TOKEN
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –ß–æ–º—É –≤–ª–∞—Å–Ω—ñ —Ç–æ–∫–µ–Ω–∏?

| –ö—Ä–∏—Ç–µ—Ä—ñ–π           | Auth0 —Ç–æ–∫–µ–Ω–∏        | –í–ª–∞—Å–Ω—ñ —Ç–æ–∫–µ–Ω–∏ ‚úÖ     |
| ------------------ | ------------------- | -------------------- |
| **API limits**     | –í–∏—Ç—Ä–∞—á–∞—î—Ç—å—Å—è –∫–≤–æ—Ç–∞  | –ë–µ–∑ –æ–±–º–µ–∂–µ–Ω—å         |
| **–ó–∞–ª–µ–∂–Ω—ñ—Å—Ç—å**     | Auth0 API           | –õ–æ–∫–∞–ª—å–Ω–∞ –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è |
| **–ì–Ω—É—á–∫—ñ—Å—Ç—å**      | –§—ñ–∫—Å–æ–≤–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ | –ü–æ–≤–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å      |
| **–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å** | –î–æ–¥–∞—Ç–∫–æ–≤—ñ –∑–∞–ø–∏—Ç–∏    | –®–≤–∏–¥–∫–∞ –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è   |
| **–í–∞—Ä—Ç—ñ—Å—Ç—å**       | –ú–æ–∂–µ –±—É—Ç–∏ –¥–æ—Ä–æ–≥–æ    | –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ          |

---

## –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î

### –ö—Ä–æ–∫ 1: –í—Ö—ñ–¥ —á–µ—Ä–µ–∑ Auth0

```javascript
// –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞—Ç–∏—Å–∫–∞—î "–£–≤—ñ–π—Ç–∏"
GET / auth / login

// Auth0 –æ–±—Ä–æ–±–ª—è—î OAuth
// –ü–æ–≤–µ—Ä—Ç–∞—î –Ω–∞ callback –∑ –¥–∞–Ω–∏–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
GET / auth / callback
```

### –ö—Ä–æ–∫ 2: –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ MongoDB

```javascript
// src/server.mjs - middleware
if (req.oidc.isAuthenticated()) {
  const user = await UserModel.findOneAndUpdate(
    { auth0Id: auth0User.sub },
    { email, name, picture, lastLogin: new Date() },
    { upsert: true, new: true }
  )
}
```

### –ö—Ä–æ–∫ 3: –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –≤–ª–∞—Å–Ω–æ–≥–æ JWT

```javascript
// src/middleware/auth.mjs
export const generateJWT = (user) => {
  return jwt.sign(
    {
      userId: user._id,
      email: user.email,
      name: user.name,
      auth0Id: user.auth0Id
    },
    JWT_SECRET, // –ù–ê–® —Å–µ–∫—Ä–µ—Ç, –Ω–µ Auth0!
    {
      expiresIn: JWT_EXPIRES_IN,
      issuer: 'node-products-server',
      audience: 'node-products-api'
    }
  )
}
```

### –ö—Ä–æ–∫ 4: –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ç–æ–∫–µ–Ω–∞

```bash
# –û—Ç—Ä–∏–º–∞—Ç–∏ —Ç–æ–∫–µ–Ω
GET /auth/api/token

# –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –¥–ª—è API
curl -H "Authorization: Bearer YOUR_TOKEN" \
     http://localhost:3000/api/products
```

---

## –§–∞–π–ª–∏ –∑ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—î—é

| –§–∞–π–ª                                 | –©–æ —Ä–æ–±–∏—Ç—å                             |
| ------------------------------------ | ------------------------------------- |
| `src/config/auth.mjs`                | –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è Auth0 —Ç–∞ JWT             |
| `src/middleware/auth.mjs`            | –í–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è —Ç–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è —Ç–æ–∫–µ–Ω—ñ–≤      |
| `src/controllers/authController.mjs` | –ï–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –¥–ª—è —Ç–æ–∫–µ–Ω—ñ–≤                 |
| `src/server.mjs`                     | Middleware —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ |

---

## FAQ

### –ß–∏ –±–µ–∑–ø–µ—á–Ω–æ —Ü–µ?

‚úÖ **–¢–∞–∫!** –¢–æ–∫–µ–Ω–∏ –ø—ñ–¥–ø–∏—Å–∞–Ω—ñ —Å–µ–∫—Ä–µ—Ç–Ω–∏–º –∫–ª—é—á–µ–º —ñ –º–∞—é—Ç—å —Ç–µ—Ä–º—ñ–Ω –¥—ñ—ó. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–∞ –¥–ª—è –±–∞–≥–∞—Ç—å–æ—Ö –¥–æ–¥–∞—Ç–∫—ñ–≤.

### –ß–∏ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ç–æ–∫–µ–Ω–∏ Auth0?

‚úÖ **–¢–∞–∫**, –∞–ª–µ –¥–ª—è —Ü—å–æ–≥–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ:

- –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ `jwks-rsa`
- –ó–º—ñ–Ω–∏—Ç–∏ –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—é –Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É —á–µ—Ä–µ–∑ Auth0 JWKS endpoint
- –í–∏—Ç—Ä–∞—á–∞—Ç–∏ –∫–≤–æ—Ç—É Auth0 –Ω–∞ –∫–æ–∂–µ–Ω –∑–∞–ø–∏—Ç

–î–ª—è –±—ñ–ª—å—à–æ—Å—Ç—ñ –≤–∏–ø–∞–¥–∫—ñ–≤ –≤–ª–∞—Å–Ω—ñ —Ç–æ–∫–µ–Ω–∏ - –∫—Ä–∞—â–µ —Ä—ñ—à–µ–Ω–Ω—è.

### –Ø–∫ –æ–Ω–æ–≤–∏—Ç–∏ —Ç–æ–∫–µ–Ω?

–ü—Ä–æ—Å—Ç–æ –∑—Ä–æ–±—ñ—Ç—å –Ω–æ–≤–∏–π –∑–∞–ø–∏—Ç –¥–æ `/auth/api/token` (—è–∫—â–æ —Å–µ—Å—ñ—è —â–µ –∞–∫—Ç–∏–≤–Ω–∞).

### –Ø–∫ —Å–∫–∞—Å—É–≤–∞—Ç–∏ –≤—Å—ñ —Ç–æ–∫–µ–Ω–∏?

–ó–º—ñ–Ω—ñ—Ç—å `JWT_SECRET` —É `.env` - –≤—Å—ñ —Å—Ç–∞—Ä—ñ —Ç–æ–∫–µ–Ω–∏ —Å—Ç–∞–Ω—É—Ç—å –Ω–µ–¥—ñ–π—Å–Ω–∏–º–∏.

---

## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

- üìñ [–ü–æ–≤–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è](AUTHENTICATION.md)
- üöÄ [–®–≤–∏–¥–∫–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è](AUTH_SETUP.md)
- üîß [–ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è](CONFIG.md)

---

**–°—Ç–≤–æ—Ä–µ–Ω–æ:** –î–ª—è –Ω–∞–≤—á–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç—É Node.js Express Products Server  
**–ú–æ–¥–µ–ª—å:** Hybrid Authentication (Auth0 + Custom JWT)
